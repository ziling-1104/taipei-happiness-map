<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>å°åŒ—å¹¸ç¦åœ°åœ– Taipei Vibe Finder</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Main CSS -->
    <link rel="stylesheet" href="/static/main.css">

</head>

<body>

<header class="top-bar">
    âœ¨ å°åŒ—å¹¸ç¦åœ°åœ– ğŸ—ºï¸
    <a href="/survey">æƒ…ç·’å•å·</a>
</header>

<div class="container">

    <!-- å·¦åœ°åœ–ï¼šLeaflet -->
    <div id="map-area" class="map-area">
        {{ map_html | safe }}
    </div>

    <!-- å³å´æ¨è–¦ -->
    <div class="sidebar">

        <div style="font-size:20px; font-weight:700; margin-bottom: 10px;">
            ä»Šæ—¥å¿ƒæƒ…ï¼š{{ mood }}
        </div>
        <div id="user-location" style="font-size: 14px; color: #555; margin-bottom: 15px;">
            æ­£åœ¨ç²å–æ‚¨çš„ä½ç½®...
        </div>

        <div class="mood-selector">
            <a href="javascript:void(0);" onclick="switchMood('ç™‚ç™’æ”¾é¬†')" class="{{ 'active-relax' if mood=='ç™‚ç™’æ”¾é¬†' else '' }}">#ç™‚ç™’æ”¾é¬†</a>
            <a href="javascript:void(0);" onclick="switchMood('åŸå¸‚æ¼«æ­¥')" class="{{ 'active-quiet' if mood=='åŸå¸‚æ¼«æ­¥' else '' }}">#åŸå¸‚æ¼«æ­¥</a>
            <a href="javascript:void(0);" onclick="switchMood('æ–‡åŒ–æ¢ç´¢')" class="{{ 'active-art' if mood=='æ–‡åŒ–æ¢ç´¢' else '' }}">#æ–‡åŒ–æ¢ç´¢</a>
            <a href="javascript:void(0);" onclick="switchMood('æ´»åŠ›å……é›»')" class="{{ 'active-active' if mood=='æ´»åŠ›å……é›»' else '' }}">#æ´»åŠ›å……é›»</a>
        </div>

        <br>

        <div id="rec-list">
            {% for r in recommendations %}
            <div class="recommend-card" style="border-left: 8px solid {{ r.happiness_color }};">
                <div class="card-content">
                <div style="font-size:18px;font-weight:700;">{{ r.name }}</div>
                <div style="color:#636e72;font-size:13px;">åˆ†é¡ï¼š{{ r.category }}</div>
                    <div style="font-size:20px;margin-top:8px;font-weight:700;color:{{ r.happiness_color }};">
                    å¹¸ç¦æŒ‡æ•¸ï¼š{{ r.happiness }}
                </div>

                <div class="show-detail" onclick="toggleDetail('{{ loop.index }}')">æŸ¥çœ‹å…¬å¼</div>
                <button class="btn-checkin" onclick="completeTask('{{ r.name }}', {{ r.lat }}, {{ r.lon }})">æ‰“å¡</button>

                <div id="detail-{{ loop.index }}" class="detail-box">
                    baseï¼š{{ r.base }}<br>
                    weightï¼š{{ r.weight }}<br>
                    value_normï¼š{{ r.value_norm }}<br>
                    åŸå§‹ valueï¼š{{ r.value }}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- å·²å®Œæˆä»»å‹™é¡¯ç¤ºå€å¡Š -->
        <div class="completed-tasks" style="margin-top: 30px;">
            <h2 style="font-size: 20px; color: #344675; margin-bottom: 10px;">å·²å®Œæˆä»»å‹™ âœ¨</h2>
            <div id="completed-tasks-list">
                {% if completed_tasks %}
                    {% for task in completed_tasks %}
                        <div class="task-item" style="background: #e6ffe6; padding: 10px; border-radius: 8px; margin-bottom: 8px; border: 1px solid #a6e3a6;">
                            {{ task.name }} ({{ task.timestamp.split('T')[0] }})
                        </div>
                    {% endfor %}
                {% else %}
                    <p style="color: #777;">ç›®å‰æ²’æœ‰å·²å®Œæˆçš„ä»»å‹™ã€‚</p>
                {% endif %}
            </div>
        </div>

        <!-- å·²è§£é–æˆå°±é¡¯ç¤ºå€å¡Š -->
        <div class="unlocked-achievements" style="margin-top: 30px;">
            <h2 style="font-size: 20px; color: #344675; margin-bottom: 10px;">å·²è§£é–æˆå°± ğŸ†</h2>
            <div id="unlocked-achievements-list">
                {% if completed_tasks %}
                    {% for item in completed_tasks %}
                        {% if 'description' in item %}
                            <div class="achievement-item" style="background: #e6f7ff; padding: 10px; border-radius: 8px; margin-bottom: 8px; border: 1px solid #a6d9f0;">
                                <b>{{ item.name }}</b><br>
                                <span style="font-size: 13px; color: #555;">{{ item.description }} ({{ item.timestamp.split('T')[0] }})</span>
                            </div>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <p style="color: #777;">ç›®å‰æ²’æœ‰å·²è§£é–çš„æˆå°±ã€‚</p>
                {% endif %}
            </div>
        </div>
    </div>

</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<!-- ä¸» JS -->
<script src="/static/main.js"></script>

<script>
    // â­ å¿…é ˆå®šç¾©çš„è®Šæ•¸ï¼ˆä¸»ç¨‹å¼æ‰çŸ¥é“æœ‰å“ªäº›æ¨è–¦ï¼‰
    const recommendationsData = {{ recommendations|tojson }};

    window.onload = function () {
        // åœ¨é€™è£¡èª¿ç”¨ renderRecommendationListï¼Œç¢ºä¿ recommendationsData å·²è¼‰å…¥
        renderRecommendationList(recommendationsData);
        showUserLocation(); // ç¢ºä¿åœ¨æ¸²æŸ“åˆ—è¡¨å¾Œé¡¯ç¤ºç”¨æˆ¶ä½ç½®ï¼Œä»¥ä¾¿å•Ÿç”¨æŒ‰éˆ•
    };
</script>

</body>
</html>
